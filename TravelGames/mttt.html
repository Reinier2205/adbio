<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Tic Tac Toe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --felt-green: #0a4821;
            --dark-wood: #2a1a1f;
            --gold: #ffd700;
            --light-gold: #fff8e1;
            --dark-red: #8c0000;
            --ivory: #faf8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--dark-wood);
            background-image: radial-gradient(circle, #4d322e 0%, var(--dark-wood) 70%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem;
            touch-action: manipulation;
        }

        .casino-table {
            background: var(--felt-green);
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                              radial-gradient(rgba(255, 255, 255, 0.1) 1px, var(--felt-green) 1px);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            border: 10px solid #4a2c2a;
            box-shadow: 0 0 0 5px var(--gold), inset 0 0 25px rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 1.5rem;
            width: 100%;
            max-width: 600px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            font-size: 2.2rem;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.7);
            margin-bottom: 1.5rem;
        }

        .players {
            display: flex;
            justify-content: space-around;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .player {
            background: linear-gradient(145deg, #3e1e24, #2a1a1f);
            padding: 0.9rem;
            border-radius: 10px;
            width: 42%;
            transition: all 0.3s ease;
            border: 3px solid #1a1a1a;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5), 0 5px 15px rgba(0,0,0,0.4);
        }

        .player.active {
            border-color: var(--gold);
            transform: scale(1.05);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5), 0 5px 15px rgba(0,0,0,0.4), 0 0 20px var(--gold);
        }

        .player-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .player-header h2 {
            color: var(--light-gold);
            font-size: 1.1rem;
        }

        .edit-name-icon {
            cursor: pointer;
            font-size: 1rem;
            color: var(--gold);
            transition: transform 0.2s;
            border-radius: 4px;
        }
        .edit-name-icon:hover { transform: scale(1.2); }
        .edit-name-icon:focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        .player-name-input {
            background-color: var(--light-gold);
            border: 1px solid var(--gold);
            border-radius: 4px;
            padding: 4px;
            font-family: 'Lato', sans-serif;
            text-align: center;
            width: 80%;
        }

        .mark {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .win-tally {
            color: var(--light-gold);
            font-size: 1.1rem;
            margin-top: 0.5rem;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            margin: 1.5rem 0;
            aspect-ratio: 1 / 1;
            max-width: 500px;
            margin: 1.5rem auto;
        }

        .mini-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            background: linear-gradient(145deg, #0f5a2c, #0a4821);
            border: 3px solid #1a1a1a;
            border-radius: 8px;
            padding: 4px;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        .mini-board.won-x::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
            z-index: 1;
            border-radius: 8px;
        }

        .mini-board.won-o::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,248,225,0.3) 0%, transparent 70%);
            z-index: 1;
            border-radius: 8px;
        }

        .mini-board.highlight {
            box-shadow: 0 0 0 4px var(--gold), inset 0 0 15px rgba(255,255,255,0.1);
            transform: scale(1.02);
        }

        .cell {
            background: linear-gradient(145deg, #1a6a3a, #0f5a2c);
            border: 2px solid #1a1a1a;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .cell:hover:not(.disabled) {
            transform: scale(1.05);
            box-shadow: inset 0 0 12px rgba(255,255,255,0.1), 0 0 8px var(--gold);
        }

        .cell.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .cell.x::before, .cell.x::after {
            content: '';
            position: absolute;
            width: 70%;
            height: 8px;
            background-color: var(--gold);
            border-radius: 4px;
        }

        .cell.x::before {
            transform: rotate(45deg);
        }

        .cell.x::after {
            transform: rotate(-45deg);
        }

        .cell.o::before {
            content: '';
            position: absolute;
            width: 60%;
            height: 60%;
            border: 8px solid var(--light-gold);
            border-radius: 50%;
        }

        #game-status {
            min-height: 24px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--light-gold);
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px black;
        }

        .controls button {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            padding: 0.8rem 1.5rem;
            border: 2px solid #111;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 0.5rem;
            color: white;
            text-shadow: 1px 1px 2px black;
            box-shadow: 0 4px 0 #111, 0 5px 10px rgba(0,0,0,0.5);
        }
        .controls button:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #111;
        }
        .controls button:disabled { background: #666; color: #aaa; box-shadow: 0 4px 0 #333; cursor: not-allowed;}
        #btn-reset { background: linear-gradient(145deg, #ffeb3b, var(--gold)); color: #333; }

        .win-message {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, #3e1e24, #2a1a1f);
            color: var(--light-gold);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px var(--gold);
            text-align: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        /* Help button */
        .help-btn{
            position:absolute;top:12px;right:12px;width:36px;height:36px;border-radius:50%;
            border:2px solid #111;background:radial-gradient(circle at 30% 30%, var(--gold), #b8860b);
            color:#111;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;
            box-shadow:0 3px 0 #111, 0 5px 10px rgba(0,0,0,0.5);
        }
        .help-btn:active{ transform: translateY(2px); box-shadow:0 1px 0 #111; }
        
        /* Home button (top-left) */
        .home-btn{
            position:absolute;top:12px;left:12px;width:36px;height:36px;border-radius:50%;
            border:2px solid #111;background:radial-gradient(circle at 30% 30%, var(--gold), #b8860b);
            color:#111;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;
            box-shadow:0 3px 0 #111, 0 5px 10px rgba(0,0,0,0.5);text-decoration:none;
        }
        .home-btn:active{ transform: translateY(2px); box-shadow:0 1px 0 #111; }

        /* Help modal */
        .help-modal{ position:fixed; inset:0; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; opacity:0; visibility:hidden; transition:all .3s ease; z-index:1000; }
        .help-modal.show{ opacity:1; visibility:visible; }
        .help-panel{ background:linear-gradient(145deg,#3e1e24,#2a1a1f); color:var(--light-gold); padding:2rem 2.2rem; border-radius:15px; border:3px solid var(--gold); box-shadow:0 0 30px var(--gold); max-width:560px; width:90%; text-align:left; transform:scale(.9); transition:transform .3s ease; }
        .help-modal.show .help-panel{ transform:scale(1); }
        .help-panel h3{ font-family:'Cinzel', serif; font-size:2rem; color:var(--gold); margin:0 0 .75rem; }
        .help-panel h4{ font-family:'Lato',sans-serif; font-size:1.1rem; color:var(--light-gold); margin:1rem 0 .4rem; }
        .help-panel p, .help-panel li{ font-size:1rem; line-height:1.5; }
        .help-actions{ margin-top:1.25rem; text-align:center; }
        .close-help{ font-family:'Cinzel',serif; font-size:1.1rem; padding:.7rem 1.6rem; border:2px solid #111; border-radius:8px; background:linear-gradient(145deg, #ffeb3b, var(--gold)); cursor:pointer; box-shadow:0 4px 0 #111, 0 5px 10px rgba(0,0,0,.5); }
        .close-help:active{ transform: translateY(2px); box-shadow:0 1px 0 #111; }
        
        .win-message.show {
            opacity: 1;
            visibility: visible;
        }
        
        .win-message h3 { 
            font-family: 'Cinzel', serif; 
            font-size: 2rem; 
            color: var(--gold); 
            margin-bottom: 0.5rem; 
        }
        
        /* Setup modal */
        .setup-modal{ position:fixed; inset:0; background:rgba(0,0,0,.8); display:flex; align-items:center; justify-content:center; opacity:0; visibility:hidden; transition:all .3s ease; z-index:1100; }
        .setup-modal.show{ opacity:1; visibility:visible; }
        .setup-panel{ background:linear-gradient(145deg,#3e1e24,#2a1a1f); color:var(--light-gold); padding:2rem 2.2rem; border-radius:15px; border:3px solid var(--gold); box-shadow:0 0 30px var(--gold); max-width:560px; width:92%; text-align:left; transform:scale(.9); transition:transform .3s ease; }
        .setup-modal.show .setup-panel{ transform:scale(1); }
        .setup-panel h3{ font-family:'Cinzel', serif; font-size:2rem; color:var(--gold); margin:0 0 .75rem; }
        .setup-row{ margin:.6rem 0; }
        .setup-row label{ display:block; font-weight:700; margin-bottom:.35rem; }
        .setup-input{ width:100%; padding:.6rem .7rem; border:2px solid var(--gold); border-radius:8px; background:var(--light-gold); color:#222; font-family:'Lato',sans-serif; }
        
        @media (max-width: 600px) {
            .casino-table {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .player-header h2 {
                font-size: 1rem;
            }
            
            .mark {
                font-size: 1.5rem;
            }
            
            .win-message {
                width: 90%;
                padding: 1rem;
            }
            
            .win-message h3 {
                font-size: 1.5rem;
            }
            
            .cell {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>

    <div class="casino-table">
        <a href="index.html" class="home-btn" aria-label="Home">üè†</a>
        <button class="help-btn" id="help-btn" aria-label="How to play">?</button>
        <h1>Mega Tic Tac Toe</h1>
        
        <div class="win-message" id="win-message">
            <h3 id="winner-text"></h3>
            <button id="btn-continue">Continue</button>
        </div>
        
        <div class="players">
            <div id="player-x" class="player active">
                <div class="player-header">
                    <h2 id="player-x-name">Player X</h2>
                    <span class="edit-name-icon" role="button" tabindex="0" aria-label="Edit Player X Name">‚úèÔ∏è</span>
                </div>
                <p class="mark">X</p>
                <p class="win-tally">Wins: <span id="player-x-wins">0</span></p>
            </div>
            <div id="player-o" class="player">
                <div class="player-header">
                    <h2 id="player-o-name">Player O</h2>
                    <span class="edit-name-icon" role="button" tabindex="0" aria-label="Edit Player O Name">‚úèÔ∏è</span>
                </div>
                <p class="mark">O</p>
                <p class="win-tally">Wins: <span id="player-o-wins">0</span></p>
            </div>
        </div>

        <div class="game-area">
            <p id="game-status" aria-live="polite">Player X's turn</p>
            <div class="board" id="game-board"></div>
            <div class="controls">
                <button id="btn-reset">üîÑ New Game</button>
            </div>
        </div>
    </div>

    <!-- Setup Modal -->
    <div id="setup-modal" class="setup-modal" role="dialog" aria-modal="true" aria-labelledby="setup-title">
        <div class="setup-panel" tabindex="-1">
            <h3 id="setup-title">Game Setup</h3>
            <div class="setup-row">
                <label for="pname-0">Player X name</label>
                <input id="pname-0" type="text" class="setup-input" placeholder="Player X">
            </div>
            <div class="setup-row">
                <label for="pname-1">Player O name</label>
                <input id="pname-1" type="text" class="setup-input" placeholder="Player O">
            </div>
            <div class="setup-actions" style="text-align:center; margin-top:1rem;">
                <button id="confirm-setup" class="close-help">Start</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            class MegaTicTacToe {
                constructor() {
                    this.cacheDom();
                    this.bindEvents();
                    this.startNewGame();
                }

                cacheDom() {
                    this.DOM = {
                        playerX: document.getElementById('player-x'),
                        playerO: document.getElementById('player-o'),
                        playerXName: document.getElementById('player-x-name'),
                        playerOName: document.getElementById('player-o-name'),
                        playerXWins: document.getElementById('player-x-wins'),
                        playerOWins: document.getElementById('player-o-wins'),
                        gameStatus: document.getElementById('game-status'),
                        board: document.getElementById('game-board'),
                        btnReset: document.getElementById('btn-reset'),
                        winMessage: document.getElementById('win-message'),
                        winnerText: document.getElementById('winner-text'),
                        btnContinue: document.getElementById('btn-continue'),
                        editIcons: document.querySelectorAll('.edit-name-icon')
                    };
                }

                bindEvents() {
                    this.DOM.btnReset.addEventListener('click', () => this.startNewGame());
                    this.DOM.btnContinue.addEventListener('click', () => {
                        this.DOM.winMessage.classList.remove('show');
                        this.startNewGame();
                    });
                    
                    this.DOM.editIcons.forEach((icon, index) => {
                        icon.addEventListener('click', () => this.editName(index));
                        icon.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                this.editName(index);
                            }
                        });
                    });
                }

                startNewGame() {
                    this.state = {
                        board: Array(9).fill(null).map(() => Array(9).fill(null)),
                        mainBoard: Array(9).fill(null),
                        currentPlayer: 'X',
                        gameActive: true,
                        nextBoard: null,
                        playerNames: ['Player X', 'Player O'],
                        wins: [0, 0]
                    };
                    
                    this.renderBoard();
                    this.updateStatus();
                    this.updatePlayerTurnIndicator();
                }

                renderBoard() {
                    this.DOM.board.innerHTML = '';
                    
                    for (let big = 0; big < 9; big++) {
                        const miniBoard = document.createElement('div');
                        miniBoard.className = 'mini-board';
                        miniBoard.dataset.big = big;
                        
                        if (this.state.mainBoard[big] === 'X') {
                            miniBoard.classList.add('won-x');
                        } else if (this.state.mainBoard[big] === 'O') {
                            miniBoard.classList.add('won-o');
                        } else if (this.state.nextBoard === big || this.state.nextBoard === null) {
                            miniBoard.classList.add('highlight');
                        }
                        
                        for (let small = 0; small < 9; small++) {
                            const cell = document.createElement('div');
                            cell.className = 'cell';
                            cell.dataset.big = big;
                            cell.dataset.small = small;
                            
                            if (this.state.board[big][small] === 'X') {
                                cell.classList.add('x');
                            } else if (this.state.board[big][small] === 'O') {
                                cell.classList.add('o');
                            }
                            
                            // Disable cell if:
                            // - Mini-board is won
                            // - Game is inactive
                            // - Not the correct next board (unless nextBoard is null)
                            if (this.state.mainBoard[big] !== null || 
                                !this.state.gameActive || 
                                (this.state.nextBoard !== null && this.state.nextBoard !== big)) {
                                cell.classList.add('disabled');
                            }
                            
                            cell.addEventListener('click', () => this.handleCellClick(big, small));
                            miniBoard.appendChild(cell);
                        }
                        
                        this.DOM.board.appendChild(miniBoard);
                    }
                }

                handleCellClick(big, small) {
                    if (!this.state.gameActive) return;
                    if (this.state.mainBoard[big] !== null) return;
                    if (this.state.nextBoard !== null && this.state.nextBoard !== big) return;
                    if (this.state.board[big][small] !== null) return;
                    
                    this.makeMove(big, small);
                }

                makeMove(big, small) {
                    // Place mark
                    this.state.board[big][small] = this.state.currentPlayer;
                    
                    // Check if mini-board is won
                    const miniWinner = this.checkMiniBoardWin(big);
                    if (miniWinner) {
                        this.state.mainBoard[big] = miniWinner;
                    }
                    
                    // Determine next board
                    this.state.nextBoard = this.state.mainBoard[small] === null ? small : null;
                    
                    // Check main board win
                    const mainWinner = this.checkMainBoardWin();
                    if (mainWinner) {
                        this.state.gameActive = false;
                        this.state.winner = mainWinner;
                        
                        // Update win count
                        if (mainWinner === 'X') {
                            this.state.wins[0]++;
                            this.DOM.playerXWins.textContent = this.state.wins[0];
                        } else {
                            this.state.wins[1]++;
                            this.DOM.playerOWins.textContent = this.state.wins[1];
                        }
                        
                        this.showWinner();
                        return;
                    }
                    
                    // Check for draw (all mini-boards filled)
                    if (this.isMainBoardFull()) {
                        this.state.gameActive = false;
                        this.showDraw();
                        return;
                    }
                    
                    // Switch player
                    this.state.currentPlayer = this.state.currentPlayer === 'X' ? 'O' : 'X';
                    this.updateStatus();
                    this.updatePlayerTurnIndicator();
                    this.renderBoard();
                }

                checkMiniBoardWin(big) {
                    const board = this.state.board[big];
                    const winPatterns = [
                        [0,1,2], [3,4,5], [6,7,8],
                        [0,3,6], [1,4,7], [2,5,8],
                        [0,4,8], [2,4,6]
                    ];
                    
                    for (const pattern of winPatterns) {
                        const [a,b,c] = pattern;
                        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                            return board[a];
                        }
                    }
                    
                    // Check if mini-board is full (draw)
                    if (board.every(cell => cell !== null)) {
                        return 'draw';
                    }
                    
                    return null;
                }

                checkMainBoardWin() {
                    const board = this.state.mainBoard;
                    const winPatterns = [
                        [0,1,2], [3,4,5], [6,7,8],
                        [0,3,6], [1,4,7], [2,5,8],
                        [0,4,8], [2,4,6]
                    ];
                    
                    for (const pattern of winPatterns) {
                        const [a,b,c] = pattern;
                        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                            return board[a];
                        }
                    }
                    
                    return null;
                }

                isMainBoardFull() {
                    return this.state.mainBoard.every(cell => cell !== null);
                }

                updateStatus() {
                    if (this.state.winner) {
                        this.DOM.gameStatus.textContent = `${this.getCurrentPlayerName()} wins!`;
                    } else if (!this.state.gameActive) {
                        this.DOM.gameStatus.textContent = "Game ended in a draw!";
                    } else {
                        const nextBoard = this.state.nextBoard !== null 
                            ? `in board ${this.state.nextBoard + 1}`
                            : 'anywhere';
                        this.DOM.gameStatus.textContent = `${this.getCurrentPlayerName()}'s turn (${nextBoard})`;
                    }
                }
                
                getCurrentPlayerName() {
                    return this.state.currentPlayer === 'X' 
                        ? this.state.playerNames[0] 
                        : this.state.playerNames[1];
                }

                updatePlayerTurnIndicator() {
                    this.DOM.playerX.classList.toggle('active', this.state.currentPlayer === 'X');
                    this.DOM.playerO.classList.toggle('active', this.state.currentPlayer === 'O');
                }

                showWinner() {
                    this.updateStatus();
                    this.DOM.winnerText.textContent = `${this.getCurrentPlayerName()} Wins!`;
                    this.DOM.winMessage.classList.add('show');
                    this.renderBoard();
                }

                showDraw() {
                    this.updateStatus();
                    this.DOM.winnerText.textContent = "It's a Draw!";
                    this.DOM.winMessage.classList.add('show');
                    this.renderBoard();
                }
                
                editName(playerIndex) {
                    const nameEl = playerIndex === 0 ? this.DOM.playerXName : this.DOM.playerOName;
                    const parent = nameEl.parentElement;
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = this.state.playerNames[playerIndex];
                    input.className = 'player-name-input';
                    
                    parent.replaceChild(input, nameEl);
                    input.focus();
                    
                    const saveName = () => {
                        const newName = input.value.trim() || `Player ${playerIndex === 0 ? 'X' : 'O'}`;
                        this.state.playerNames[playerIndex] = newName;
                        nameEl.textContent = newName;
                        parent.replaceChild(nameEl, input);
                        this.updateStatus();
                    };
                    
                    input.addEventListener('blur', saveName);
                    input.addEventListener('keydown', (e) => { 
                        if (e.key === 'Enter') {
                            input.blur();
                        }
                    });
                }
            }

            const game = new MegaTicTacToe();

            // Setup modal wiring
            const setupModal = document.getElementById('setup-modal');
            const setupPanel = setupModal.querySelector('.setup-panel');
            const confirmSetup = document.getElementById('confirm-setup');
            const openSetup = () => { setupModal.classList.add('show'); setTimeout(()=>setupPanel.focus(),0); };
            const closeSetup = () => { setupModal.classList.remove('show'); };
            openSetup();

            confirmSetup.addEventListener('click', () => {
                const px = (document.getElementById('pname-0').value || '').trim() || 'Player X';
                const po = (document.getElementById('pname-1').value || '').trim() || 'Player O';
                document.getElementById('player-x-name').textContent = px;
                document.getElementById('player-o-name').textContent = po;
                if (game && game.state && game.state.playerNames) {
                    game.state.playerNames = [px, po];
                    game.updateStatus();
                }
                closeSetup();
            });

            // Help modal wiring
            const helpBtn = document.getElementById('help-btn');
            const helpModal = document.createElement('div');
            helpModal.className = 'help-modal';
            helpModal.id = 'help-modal';
            helpModal.setAttribute('role','dialog');
            helpModal.setAttribute('aria-modal','true');
            helpModal.setAttribute('aria-labelledby','help-title');
            helpModal.innerHTML = `
                <div class="help-panel" tabindex="-1">
                    <h3 id="help-title">How to Play: Mega Tic Tac Toe</h3>
                    <p>Play on a 3x3 grid of mini-boards. Win mini-boards to claim them, then win the main board!</p>
                    <h4>Rules</h4>
                    <ul>
                        <li>Your move determines where your opponent plays next</li>
                        <li>If you play in position N of a mini-board, opponent must play in mini-board N</li>
                        <li>If the required mini-board is already won/full, opponent can play anywhere</li>
                        <li>Win 3 mini-boards in a row to win the game</li>
                    </ul>
                    <h4>Strategy</h4>
                    <ul>
                        <li>Force opponents into disadvantageous boards</li>
                        <li>Block opponents from completing rows</li>
                        <li>Watch for double threats!</li>
                    </ul>
                    <div class="help-actions">
                        <button id="close-help" class="close-help">Got it</button>
                    </div>
                </div>`;
            document.body.appendChild(helpModal);
            const panel = helpModal.querySelector('.help-panel');
            const closeHelpBtn = () => helpModal.querySelector('#close-help');
            const open = () => { helpModal.classList.add('show'); setTimeout(()=>panel.focus(),0); };
            const close = () => { helpModal.classList.remove('show'); helpBtn.focus(); };
            helpBtn.addEventListener('click', open);
            helpModal.addEventListener('click', (e)=>{ if(e.target === helpModal) close(); });
            document.addEventListener('click', (e)=>{ if(e.target && e.target.id==='close-help') close(); });
            document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && helpModal.classList.contains('show')) close(); });
        });
    </script>
</body>
</html>