<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Runner Validation - EventBingo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Test Runner Validation</h1>
        <p>Validates that all test files are properly structured and can run basic functionality tests.</p>
        
        <div class="test-controls">
            <button onclick="validateAllTests()">ğŸš€ Validate All Test Files</button>
            <button onclick="validateUnitTests()">ğŸ“¦ Validate Unit Tests</button>
            <button onclick="validateIntegrationTests()">ğŸ”„ Validate Integration Tests</button>
            <button onclick="validateUXTests()">ğŸ¯ Validate UX Tests</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ Clear Results</button>
        </div>

        <div id="testSummary" class="summary" style="display: none;"></div>
        <div id="testResults"></div>
    </div>

    <!-- Include required scripts -->
    <script src="js/session-manager.js"></script>
    <script src="js/player-authenticator.js"></script>
    <script src="js/flow-controller.js"></script>
    <script src="js/state-preserver.js"></script>

    <script>
        // Test tracking
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            results: []
        };

        function addResult(message, type = 'info', category = 'general') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = `[${category.toUpperCase()}] ${message}`;
            resultsDiv.appendChild(resultDiv);
            
            testStats.results.push({ message, type, category, timestamp: Date.now() });
            
            if (type === 'success') testStats.passed++;
            if (type === 'error') testStats.failed++;
            testStats.total++;
            
            updateSummary();
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('testSummary');
            const passRate = testStats.total > 0 ? ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            summaryDiv.innerHTML = `
                ğŸ“Š Validation Summary: ${testStats.passed}/${testStats.total} passed (${passRate}%) | 
                âœ… ${testStats.passed} passed | âŒ ${testStats.failed} failed
            `;
            summaryDiv.style.display = 'block';
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('testSummary').style.display = 'none';
            testStats = { total: 0, passed: 0, failed: 0, results: [] };
        }

        async function runTest(testName, testFn, category = 'test') {
            try {
                const result = await testFn();
                if (result === true) {
                    addResult(`âœ… ${testName}`, 'success', category);
                } else if (result === false) {
                    addResult(`âŒ ${testName}`, 'error', category);
                } else if (result && result.success) {
                    addResult(`âœ… ${testName}: ${result.message || 'Passed'}`, 'success', category);
                } else if (result && !result.success) {
                    addResult(`âŒ ${testName}: ${result.message || 'Failed'}`, 'error', category);
                } else {
                    addResult(`âš ï¸ ${testName}: Unexpected result`, 'warning', category);
                }
            } catch (error) {
                addResult(`âŒ ${testName}: ${error.message}`, 'error', category);
            }
        }

        // Validate Unit Tests
        async function validateUnitTests() {
            addResult('ğŸ“¦ Validating Unit Test Infrastructure', 'info', 'unit');
            
            await runTest('SessionManager class availability', async () => {
                return typeof SessionManager === 'function';
            }, 'unit');

            await runTest('PlayerAuthenticator class availability', async () => {
                return typeof PlayerAuthenticator === 'function';
            }, 'unit');

            await runTest('FlowController class availability', async () => {
                return typeof FlowController === 'function';
            }, 'unit');

            await runTest('StatePreserver class availability', async () => {
                return typeof StatePreserver === 'function';
            }, 'unit');

            await runTest('SessionManager instantiation', async () => {
                const sessionManager = new SessionManager();
                return sessionManager && typeof sessionManager.isStorageAvailable === 'function';
            }, 'unit');

            await runTest('PlayerAuthenticator instantiation', async () => {
                const sessionManager = new SessionManager();
                const playerAuthenticator = new PlayerAuthenticator(sessionManager);
                return playerAuthenticator && typeof playerAuthenticator.createPlayerProfile === 'function';
            }, 'unit');

            await runTest('Basic SessionManager functionality', async () => {
                const sessionManager = new SessionManager();
                const isAvailable = sessionManager.isStorageAvailable();
                return typeof isAvailable === 'boolean';
            }, 'unit');

            addResult('âœ… Unit Test Infrastructure Validation Completed', 'success', 'unit');
        }

        // Validate Integration Tests
        async function validateIntegrationTests() {
            addResult('ğŸ”„ Validating Integration Test Infrastructure', 'info', 'integration');
            
            await runTest('Component integration setup', async () => {
                const sessionManager = new SessionManager();
                const playerAuthenticator = new PlayerAuthenticator(sessionManager);
                const statePreserver = new StatePreserver(sessionManager);
                const flowController = new FlowController(sessionManager, playerAuthenticator, statePreserver);
                
                return sessionManager && playerAuthenticator && statePreserver && flowController;
            }, 'integration');

            await runTest('First-time user flow components', async () => {
                const sessionManager = new SessionManager();
                const playerAuthenticator = new PlayerAuthenticator(sessionManager);
                
                // Test basic profile creation flow
                const testResult = await playerAuthenticator.createPlayerProfile(
                    'validation-test',
                    'ValidationUser',
                    'Test question?',
                    'test-answer'
                );
                
                // Clean up
                sessionManager.clearPlayerSession('validation-test');
                
                return testResult && testResult.success;
            }, 'integration');

            await runTest('Returning user flow components', async () => {
                const sessionManager = new SessionManager();
                
                // Create a session
                const saveResult = await sessionManager.savePlayerSession(
                    'returning-test',
                    'ReturningUser',
                    'Test question?',
                    'test-answer'
                );
                
                // Retrieve the session
                const session = sessionManager.getPlayerSession('returning-test');
                
                // Clean up
                sessionManager.clearPlayerSession('returning-test');
                
                return saveResult && session && session.playerName === 'ReturningUser';
            }, 'integration');

            await runTest('State preservation components', async () => {
                const sessionManager = new SessionManager();
                const statePreserver = new StatePreserver(sessionManager);
                
                const testState = {
                    eventCode: 'state-validation-test',
                    playerName: 'StateTestUser',
                    action: 'validation'
                };
                
                const saveResult = statePreserver.saveNavigationState(testState);
                const restored = statePreserver.restoreNavigationState();
                
                return saveResult && restored && restored.eventCode === testState.eventCode;
            }, 'integration');

            addResult('âœ… Integration Test Infrastructure Validation Completed', 'success', 'integration');
        }

        // Validate UX Tests
        async function validateUXTests() {
            addResult('ğŸ¯ Validating UX Test Infrastructure', 'info', 'ux');
            
            await runTest('Performance measurement capability', async () => {
                const startTime = performance.now();
                
                // Simulate some work
                const sessionManager = new SessionManager();
                sessionManager.isStorageAvailable();
                
                const duration = performance.now() - startTime;
                return typeof duration === 'number' && duration >= 0;
            }, 'ux');

            await runTest('Error handling validation', async () => {
                const sessionManager = new SessionManager();
                
                try {
                    // Test with invalid data
                    const result = sessionManager.validateSessionData({ invalid: 'data' });
                    return typeof result === 'boolean';
                } catch (error) {
                    // Should handle gracefully
                    return true;
                }
            }, 'ux');

            await runTest('Authentication flow validation', async () => {
                const sessionManager = new SessionManager();
                const playerAuthenticator = new PlayerAuthenticator(sessionManager);
                
                // Test authentication status
                const status = playerAuthenticator.getAuthenticationStatus('TestUser');
                return status && typeof status.attemptsLeft === 'number';
            }, 'ux');

            await runTest('Navigation context validation', async () => {
                const sessionManager = new SessionManager();
                const statePreserver = new StatePreserver(sessionManager);
                
                const trackResult = statePreserver.trackUserAction('validation', { test: true });
                const history = statePreserver.getNavigationHistory();
                
                return trackResult && Array.isArray(history);
            }, 'ux');

            addResult('âœ… UX Test Infrastructure Validation Completed', 'success', 'ux');
        }

        // Validate All Tests
        async function validateAllTests() {
            clearResults();
            addResult('ğŸš€ Starting Complete Test Infrastructure Validation', 'info', 'main');
            
            await validateUnitTests();
            await validateIntegrationTests();
            await validateUXTests();
            
            addResult('ğŸ‰ All Test Infrastructure Validation Completed!', 'info', 'main');
            
            // Final validation summary
            const passRate = testStats.total > 0 ? ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            if (passRate >= 95) {
                addResult(`ğŸ† Excellent! All test infrastructure is ready: ${passRate}% pass rate`, 'success', 'summary');
            } else if (passRate >= 80) {
                addResult(`ğŸ‘ Good! Test infrastructure is mostly ready: ${passRate}% pass rate`, 'info', 'summary');
            } else {
                addResult(`âš ï¸ Test infrastructure needs attention: ${passRate}% pass rate`, 'warning', 'summary');
            }
            
            // Provide next steps
            addResult('ğŸ“‹ Next Steps:', 'info', 'summary');
            addResult('1. Open test-unit-core-classes.html to run unit tests', 'info', 'summary');
            addResult('2. Open test-integration-complete-flows.html to run integration tests', 'info', 'summary');
            addResult('3. Open test-ux-flow-validation.html to run UX validation tests', 'info', 'summary');
        }

        // Auto-run validation on page load
        window.addEventListener('load', () => {
            addResult('Test infrastructure validation loaded. Click "Validate All Test Files" to verify test readiness.', 'info', 'main');
        });
    </script>
</body>
</html>