<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Fox &amp; Geese — Travel Edition</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --felt-green:#0a4821;
  --dark-wood:#2a1a1f;
  --gold:#d4af37;
  --gold-light:#ffd700;
  --light-gold:#fff8e1;
  --fox:#ff6b6b;
  --goose:#4ecdc4;
  --highlight:#ffd60a;
  --cell-gap:6px;
  --min-cell:36px;
  --max-cell:72px;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Lato',sans-serif;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  background-color:var(--dark-wood);
  display:flex;align-items:center;justify-content:center;padding:12px;
}

/* Casino table */
.container{
  width:100%;max-width:1100px;background:var(--felt-green);
  border-radius:14px;border:10px solid #4a2c2a;
  padding:clamp(12px,3.6vw,28px);
  box-shadow:0 0 0 5px var(--gold), inset 0 0 30px rgba(0,0,0,0.5);
}

/* Header */
.header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
.title{font-family:'Cinzel',serif;color:var(--gold-light);font-size:clamp(1.1rem,2.6vw,1.9rem);text-shadow:1px 1px 2px rgba(0,0,0,0.6)}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.select, .btn {
  font-family:'Inter',sans-serif;font-weight:600;border-radius:8px;border:2px solid #111;padding:.45rem .7rem;
  cursor:pointer;box-shadow:0 4px 0 #111,0 6px 18px rgba(0,0,0,0.45);
}
.select{background:var(--light-gold);color:var(--dark-wood);border:2px solid var(--gold)}
.btn{background:linear-gradient(145deg,var(--gold),#b8860b);color:#fff;text-shadow:1px 1px 2px black}
.btn.alt{background:var(--gold-light);color:#111;box-shadow:none;border:2px solid #111}

/* Status */
.status{color:var(--light-gold);font-weight:700;text-align:center;margin:10px 0;font-size:1rem}

/* Board grid */
.board-wrap{display:flex;justify-content:center}
:root{ --cell-size: clamp(var(--min-cell), 8.0vw, var(--max-cell)); }
.board{
  display:grid;
  grid-template-columns: repeat(9, var(--cell-size));
  grid-template-rows: repeat(9, var(--cell-size));
  gap:var(--cell-gap);
  justify-content:center;
  margin:0 auto;
}

/* cell styling */
.cell{
  width:var(--cell-size);height:var(--cell-size);
  border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,0.04); position:relative; user-select:none;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.35), 0 6px 14px rgba(0,0,0,0.45);
}
.cell.nonplayable{ background:transparent; opacity:0.14; filter:grayscale(80%); box-shadow:none; cursor:default }
.cell.playable{ background:rgba(0,0,0,0.16); border:2px solid rgba(0,0,0,0.33); cursor:pointer; }

/* small visual dot */
.cell .dot{ width:9px;height:9px;border-radius:50%;background:rgba(255,255,255,0.06); position:absolute; top:8px; left:8px; }

/* pieces */
.piece{
  width:calc(var(--cell-size) * 0.66); height:calc(var(--cell-size) * 0.66);
  border-radius:50%; display:flex;align-items:center;justify-content:center;
  font-family:'Cinzel',serif;font-weight:700;color:#fff;
  box-shadow: inset -4px -4px 10px rgba(255,255,255,0.06), inset 3px 3px 8px rgba(0,0,0,0.35);
  -webkit-tap-highlight-color: transparent;
}
.piece.fox{ background:var(--fox) }
.piece.goose{ background:var(--goose) }
.piece.selected{ outline:4px solid rgba(255,215,0,0.12); transform:scale(1.02) }

/* invalid move cross */
.invalid-cross{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
.invalid-cross .bar{ position:absolute; width:70%; height:8px; background:#ff4d4d; border-radius:5px; box-shadow:0 0 8px rgba(255,0,0,0.5); opacity:0.95; }
.invalid-cross .bar.a{ transform:rotate(45deg); }
.invalid-cross .bar.b{ transform:rotate(-45deg); }
.invalid-cross.fade{ transition:opacity .5s ease; opacity:0; }

/* footer */
.footer{display:flex;justify-content:space-between;align-items:center;color:var(--light-gold);margin-top:10px;font-size:.95rem}

/* help modal */
.help-modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.75); visibility:hidden; opacity:0; transition:all .18s ease; z-index:1000 }
.help-modal.show{ visibility:visible; opacity:1 }
.help-panel{ width:92%; max-width:680px; background:linear-gradient(145deg,#3e1e24,#2a1a1f); color:var(--light-gold); border-radius:12px; padding:14px; border:3px solid var(--gold); box-shadow:0 0 30px var(--gold) }
.help-panel h3{ font-family:'Cinzel',serif;color:var(--gold-light); margin-bottom:8px }

/* small screens */
@media (max-width:520px){
  :root{ --cell-size: clamp(32px, 9.0vw, 56px); }
  .header{flex-direction:column;align-items:flex-start}
}
</style>
</head>
<body>
  <main class="container" role="main" aria-label="Fox and Geese Travel Edition">
    <div class="header">
      <div class="title">Fox &amp; Geese — Travel Edition</div>

      <div class="controls" role="toolbar" aria-label="Game controls">
        <label style="color:var(--light-gold);font-weight:600;margin-right:6px">Geese side</label>
        <select id="startSide" class="select" aria-label="Select geese starting side">
          <option value="top">Top</option>
          <option value="left">Left</option>
          <option value="right">Right</option>
          <option value="bottom">Bottom</option>
        </select>

        <label style="color:var(--light-gold);font-weight:600;margin-left:6px">Geese</label>
        <select id="geeseCount" class="select" aria-label="Select geese count">
          <option value="13">13</option>
          <option value="15">15</option>
          <option value="17">17</option>
        </select>

        <button id="btnNew" class="btn" aria-label="Start new game">New Game</button>
        <button id="btnRules" class="btn alt" aria-label="Show rules">Rules</button>
      </div>
    </div>

      <div id="status" class="status" aria-live="polite">Loading...</div>

    <div class="board-wrap">
      <div id="board" class="board" role="grid" aria-label="Fox-and-geese board"></div>
    </div>

    <div class="footer">
      <div id="piecesInfo">Fox: 1 • Geese: 13</div>
      <div id="turnInfo">Turn: Geese</div>
    </div>
  </main>

  <!-- Help modal -->
  <div id="helpModal" class="help-modal" role="dialog" aria-modal="true">
    <div class="help-panel">
      <h3>Rules & Moves</h3>
      <ul>
        <li>Board: 5 blocks of 3×3 (center + 4 arms). Only those intersections are playable.</li>
        <li>Pieces: 1 fox (red), N geese (teal). Fox starts center.</li>
        <li>Turn order: Geese move first.</li>
        <li>Geese: move one step into an adjacent playable empty point. Geese may not move backward away from their starting side (this variant). They cannot capture.</li>
        <li>Fox: moves one step in any direction. Capture by jumping over an adjacent goose into the empty space beyond (same direction). Multiple jumps allowed and continue in same turn.</li>
        <li>Win: Geese win if fox has no legal move. Fox wins if geese are reduced to 2 or fewer.</li>
      </ul>
      <div style="text-align:center;margin-top:8px">
        <button id="closeRules" class="btn">Close</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const SIZE = 9;
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');
  const piecesInfo = document.getElementById('piecesInfo');
  const turnInfo = document.getElementById('turnInfo');
  const btnNew = document.getElementById('btnNew');
  const btnRules = document.getElementById('btnRules');
  const helpModal = document.getElementById('helpModal');
  const closeRules = document.getElementById('closeRules');
  const startSideSel = document.getElementById('startSide');
  const geeseCountSel = document.getElementById('geeseCount');

  let board = []; // 'empty' | 'fox' | 'goose' | null
  let turn = 'geese'; // 'geese' | 'fox' | null (game over)
  let selected = null;
  let geeseSide = 'top';
  let geeseCount = 13;

  const DIRS = [
    [-1,0],[1,0],[0,-1],[0,1],
    [-1,-1],[-1,1],[1,-1],[1,1]
  ];

  function isPlayable(r,c){
    const inRange=(rr,cc,rs,re,cs,ce)=>rr>=rs&&rr<=re&&cc>=cs&&cc<=ce;
    if (inRange(r,c,3,5,3,5)) return true;
    if (inRange(r,c,0,2,3,5)) return true;
    if (inRange(r,c,6,8,3,5)) return true;
    if (inRange(r,c,3,5,0,2)) return true;
    if (inRange(r,c,3,5,6,8)) return true;
    return false;
  }

  function initEmptyBoard(){
    board = Array.from({length:SIZE},(_,r)=>Array.from({length:SIZE},(_,c)=> isPlayable(r,c) ? 'empty' : null ));
  }

  function centre(){ return Math.floor(SIZE/2); }

  function placeInitial(side,count){
    initEmptyBoard();
    geeseSide = side; geeseCount = count;
    const cx = centre(), cy = centre();
    board[cx][cy] = 'fox';

    const cells=[];
    if (side==='top'){
      for(let r=0;r<=2;r++) for(let c=3;c<=5;c++) cells.push([r,c]);
      for(let c=2;c<=5;c++) cells.push([3,c]);
    } else if (side==='bottom'){
      for(let r=6;r<=8;r++) for(let c=3;c<=5;c++) cells.push([r,c]);
      for(let c=2;c<=5;c++) cells.push([5,c]);
    } else if (side==='left'){
      for(let c=0;c<=2;c++) for(let r=3;r<=5;r++) cells.push([r,c]);
      for(let r=2;r<=5;r++) cells.push([r,3]);
    } else { // right
      for(let c=6;c<=8;c++) for(let r=3;r<=5;r++) cells.push([r,c]);
      for(let r=2;r<=5;r++) cells.push([r,5]);
    }

    let placed=0;
    for(const [r,c] of cells){
      if (placed>=count) break;
      if (board[r][c]==='empty'){ board[r][c]='goose'; placed++; }
    }
    for(let r=0;r<SIZE && placed<count;r++){
      for(let c=0;c<SIZE && placed<count;c++){
        if (board[r][c]==='empty'){ board[r][c]='goose'; placed++; }
      }
    }
  }

  function render(){
    boardEl.innerHTML='';
    for(let r=0;r<SIZE;r++){
      for(let c=0;c<SIZE;c++){
        const cell = document.createElement('div');
        cell.className='cell';
        cell.dataset.r=r; cell.dataset.c=c;
        if (!isPlayable(r,c)) cell.classList.add('nonplayable'); else cell.classList.add('playable');

        const dot = document.createElement('div'); dot.className='dot'; cell.appendChild(dot);

        const v = board[r][c];
        if (v==='fox' || v==='goose'){
          const p = document.createElement('div');
          p.className='piece ' + (v==='fox' ? 'fox' : 'goose');
          p.dataset.r=r; p.dataset.c=c; p.dataset.type=v;
          if (selected && selected.r==r && selected.c==c) p.classList.add('selected');
          p.addEventListener('click', onPieceTap, {passive:true});
          cell.appendChild(p);
        }
        cell.addEventListener('click', onCellTap, {passive:true});
        boardEl.appendChild(cell);
      }
    }
    updateStatusUI();
  }

  function inBounds(r,c){ return r>=0 && r<SIZE && c>=0 && c<SIZE; }

  function neighbors(r,c){
    return DIRS.map(([dr,dc])=>[r+dr,c+dc,dr,dc]).filter(([nr,nc])=>inBounds(nr,nc) && isPlayable(nr,nc));
  }

  function foxMovesFrom(r,c){
    const normal=[]; const captures=[];
    for(const [nr,nc,dr,dc] of neighbors(r,c)){
      if (board[nr][nc] === 'empty') normal.push([nr,nc]);
      else if (board[nr][nc] === 'goose'){
        const lr = nr+dr, lc = nc+dc;
        if (inBounds(lr,lc) && isPlayable(lr,lc) && board[lr][lc] === 'empty'){
          captures.push({to:[lr,lc], over:[nr,nc], dir:[dr,dc]});
        }
      }
    }
    return {normal,captures};
  }

  function gooseMovesFrom(r,c){
    const out=[];
    for(const [nr,nc,dr,dc] of neighbors(r,c)){
      if (board[nr][nc] !== 'empty') continue;
      let ok=false;
      if (geeseSide==='top'){ if (nr >= r) ok=true; } // forward = downward or same row
      else if (geeseSide==='bottom'){ if (nr <= r) ok=true; }
      else if (geeseSide==='left'){ if (nc >= c) ok=true; }
      else { if (nc <= c) ok=true; }
      if (ok) out.push([nr,nc]);
    }
    return out;
  }

  function anyFoxMoves(){
    for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) if (board[r][c]==='fox'){
      const {normal,captures} = foxMovesFrom(r,c);
      if (normal.length || captures.length) return true;
    }
    return false;
  }
  function anyGeeseMoves(){
    for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) if (board[r][c]==='goose'){
      if (gooseMovesFrom(r,c).length) return true;
    }
    return false;
  }

  function countGeese(){
    let n=0; for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) if (board[r][c]==='goose') n++; return n;
  }

  function applyMove(from,to){
    const [fr,fc]=from, [tr,tc]=to;
    board[tr][tc]=board[fr][fc]; board[fr][fc]='empty';
  }
  function applyCapture(from,to,over){
    const [fr,fc]=from, [tr,tc]=to, [or,oc]=over;
    board[tr][tc]='fox'; board[fr][fc]='empty'; board[or][oc]='empty';
  }

  function clearHighlights(){
    document.querySelectorAll('.cell').forEach(el=>el.classList.remove('move-target','capture-target'));
    document.querySelectorAll('.piece').forEach(el=>el.classList.remove('selected'));
  }

  function showInvalid(cellEl){
    if (!cellEl) return;
    const cross = document.createElement('div');
    cross.className = 'invalid-cross';
    const barA = document.createElement('div'); barA.className = 'bar a';
    const barB = document.createElement('div'); barB.className = 'bar b';
    cross.appendChild(barA); cross.appendChild(barB);
    cellEl.appendChild(cross);
    setTimeout(()=>{ cross.classList.add('fade'); }, 1500);
    setTimeout(()=>{ if (cross.parentElement) cross.parentElement.removeChild(cross); }, 2000);
  }

  function showLegalMovesForSelected(){
    clearHighlights();
    if (!selected) return;
    const {r,c}=selected;
    const p=document.querySelector(`.piece[data-r="${r}"][data-c="${c}"]`); if (p) p.classList.add('selected');
  }

  function onPieceTap(e){
    e.stopPropagation();
    const el=e.currentTarget;
    if (!turn) return;
    const r=+el.dataset.r, c=+el.dataset.c, type=el.dataset.type;
    if (turn==='fox' && type==='fox'){ selected={r,c}; showLegalMovesForSelected(); }
    else if (turn==='geese' && type==='goose'){ selected={r,c}; showLegalMovesForSelected(); }
    else { showInvalid(el.parentElement); }
  }

  function onCellTap(e){
    e.stopPropagation();
    if (!turn) return;
    const el=e.currentTarget; const r=+el.dataset.r, c=+el.dataset.c;
    if (!isPlayable(r,c)) { showInvalid(el); return; }
    if (!selected){
      const val=board[r][c];
      if ((turn==='fox' && val==='fox') || (turn==='geese' && val==='goose')){ selected={r,c}; showLegalMovesForSelected(); }
      else { showInvalid(el); }
      return;
    }
    const sr=selected.r, sc=selected.c;
    if (turn==='geese'){
      const legal = gooseMovesFrom(sr,sc).some(([nr,nc])=>nr===r && nc===c);
      if (!legal) { showInvalid(el); return; }
      applyMove([sr,sc],[r,c]); selected=null; clearHighlights();
      turn='fox'; afterMove();
      return;
    }
    if (turn==='fox'){
      const {normal,captures} = foxMovesFrom(sr,sc);
      const cap = captures.find(cp => cp.to[0]===r && cp.to[1]===c);
      if (cap){
        applyCapture([sr,sc], cap.to, cap.over);
        selected = {r,c}; render();
        const more = foxMovesFrom(r,c).captures;
        if (more.length>0){
          statusEl.textContent = 'Fox captured — continue capturing.';
          showLegalMovesForSelected();
          return;
        } else {
          selected=null; clearHighlights(); turn='geese'; afterMove(); return;
        }
      }
      const isNorm = normal.some(([nr,nc])=>nr===r && nc===c);
      if (isNorm){
        applyMove([sr,sc],[r,c]); selected=null; clearHighlights(); turn='geese'; afterMove(); return;
      }
      showInvalid(el);
    }
  }

  function afterMove(){
    render();
    const geeseLeft = countGeese();
    if (geeseLeft <= 2){ statusEl.textContent = `Fox wins — geese reduced to ${geeseLeft}.`; turn=null; updateFooter(); return; }
    if (!anyFoxMoves()){ statusEl.textContent = 'Geese win — fox trapped.'; turn=null; updateFooter(); return; }
    if (!anyGeeseMoves()){ statusEl.textContent = 'Fox wins — geese cannot move.'; turn=null; updateFooter(); return; }
    statusEl.textContent = turn==='geese' ? 'Geese to move.' : 'Fox to move.';
    updateFooter();
  }

  function updateFooter(){
    piecesInfo.textContent = `Fox: 1  •  Geese: ${countGeese()}`;
    turnInfo.textContent = `Turn: ${turn ? (turn.charAt(0).toUpperCase()+turn.slice(1)) : 'Game Over'}`;
  }

  function updateStatusUI(){
    updateFooter();
    if (turn) statusEl.textContent = turn==='geese' ? 'Geese to move.' : 'Fox to move.';
    else statusEl.textContent = 'Game over.';
  }

  function startNew(){
    geeseSide = startSideSel.value;
    geeseCount = parseInt(geeseCountSel.value,10);
    placeInitial(geeseSide, geeseCount);
    turn='geese'; selected=null; clearHighlights(); render();
  }

  function placeInitial(side,count){
    initEmptyBoard();
    const cx=centre(), cy=centre();
    board[cx][cy]='fox';
    const cells=[];
    if (side==='top'){ for(let r=0;r<=2;r++) for(let c=3;c<=5;c++) cells.push([r,c]); for(let c=2;c<=5;c++) cells.push([3,c]); }
    else if (side==='bottom'){ for(let r=6;r<=8;r++) for(let c=3;c<=5;c++) cells.push([r,c]); for(let c=2;c<=5;c++) cells.push([5,c]); }
    else if (side==='left'){ for(let c=0;c<=2;c++) for(let r=3;r<=5;r++) cells.push([r,c]); for(let r=2;r<=5;r++) cells.push([r,3]); }
    else { for(let c=6;c<=8;c++) for(let r=3;r<=5;r++) cells.push([r,c]); for(let r=2;r<=5;r++) cells.push([r,5]); }

    let placed=0;
    for(const [r,c] of cells){ if (placed>=count) break; if (board[r][c]==='empty'){ board[r][c]='goose'; placed++; } }
    for(let r=0;r<SIZE && placed<count;r++){ for(let c=0;c<SIZE && placed<count;c++){ if (board[r][c]==='empty'){ board[r][c]='goose'; placed++; } } }
  }

  /* initial board builder reused */
  function initEmptyBoard(){ board = Array.from({length:SIZE},(_,r)=>Array.from({length:SIZE},(_,c)=> isPlayable(r,c) ? 'empty' : null )); }
  function centre(){ return Math.floor(SIZE/2); }

  /* hooks */
  btnNew.addEventListener('click', startNew);
  btnRules.addEventListener('click', ()=> helpModal.classList.add('show'));
  closeRules.addEventListener('click', ()=> helpModal.classList.remove('show'));
  helpModal.addEventListener('click', (e)=> { if (e.target === helpModal) helpModal.classList.remove('show'); });

  /* touch-friendly no-op to enable fast taps */
  document.addEventListener('touchstart', ()=>{}, {passive:true});

  /* start first game */
  placeInitial(startSideSel.value, parseInt(geeseCountSel.value,10));
  render();
});
</script>
</body>
</html>