<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KampBingo – Birthday Camp Photo Bingo</title>
  <style>
    :root {
      --green: #2ecc71;
      --red: #e74c3c;
      --black: #1e1e1e;
      --gray: #f9f9f9;
      --card-bg: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--gray);
      color: var(--black);
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: var(--green);
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    p {
      text-align: center;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 1rem;
      border: 2px solid var(--green);
      border-radius: 5px;
      width: 90%;
      max-width: 300px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }

    .card {
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-left: 6px solid var(--green);
      transition: box-shadow 0.2s ease;
    }

    .card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .card p {
      margin-bottom: 10px;
      font-size: 0.95rem;
      line-height: 1.4;
      color: var(--black);
    }

    input[type="file"] {
      margin-top: 5px;
      font-size: 0.9rem;
      padding: 6px;
      border-radius: 5px;
      border: 1px solid var(--green);
      background-color: #fff;
      color: var(--black);
    }

    input[type="file"]::file-selector-button {
      background-color: var(--black);
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    a {
      color: var(--red);
      font-size: 0.9rem;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    img {
      width: 100%;
      max-height: 180px;
      object-fit: cover;
      margin-top: 10px;
      border-radius: 8px;
      border: 2px solid var(--green);
    }

    @media (max-width: 600px) {
      input[type="text"] {
        width: 100%;
      }

      .card {
        padding: 12px;
      }

      .grid {
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <h1>KampBingo – Birthday Camp Photo Bingo</h1>
  <p>
    Select your name:<br />
    <input type="text" id="playerName" placeholder="Enter your name" />
  </p>

  <div class="grid" id="bingoGrid"></div>

  <script>
    const squares = [
      "An old photo with Anneke",
      "A photo from a past birthday or braai",
      "The oldest selfie you have together",
      "Anneke walking barefoot (bonus: dirty feet)",
      "Anneke drinking beer (bonus: a cheers moment)",
      "Someone borrowing something from Anneke",
      "Oliver playing ball with someone",
      "The baby with a new 'aunt' or 'uncle'",
      "Everyone gathered around the fire",
      "Anneke reading a book in peace",
      "Morning coffee in a mug that’s not yours",
      "Oliver 'helping' with something (e.g., pouring tea, fixing, or cooking)",
      "A photo of the sunset or campfire glow",
      "Someone with muddy or sandy feet",
      "Anneke’s laugh caught in a candid photo",
      "A camp game or activity moment",
      "A creative photo of beer or tea (bonus: both)",
      "Oliver on his bike",
      "A group photo of everyone",
      "Someone looking for their lost item (e.g., phone, shoe, drink)",
      "A photo showing borrowed camping gear",
      "Oliver dunking something in tea",
      "Anneke relaxing with a book and drink",
      "The baby smiling",
      "Everyone waving goodnight at the fire"
    ];

    const grid = document.getElementById("bingoGrid");
    const playerNameInput = document.getElementById("playerName");
    const workerURL = "https://rapid-hill-7b92.reinier-olivier.workers.dev/";

    function createCard(square, index) {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <p>${square}</p>
        <input type="file" id="file${index}" />
        <div id="result${index}"></div>
      `;
      grid.appendChild(div);

      const fileInput = div.querySelector(`#file${index}`);
      const resultDiv = div.querySelector(`#result${index}`);

      fileInput.addEventListener("change", async (e) => {
        const player = playerNameInput.value.trim();
        if (!player) {
          alert("Please enter your name first.");
          fileInput.value = "";
          return;
        }

        const file = e.target.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append("file", file);
        formData.append("player", player);
        formData.append("square", square);

        resultDiv.textContent = "Uploading...";

        try {
          const res = await fetch(workerURL, {
            method: "POST",
            body: formData,
          });
          const data = await res.json();

          if (data.url) {
            resultDiv.innerHTML = `
              <a href="${data.url}" target="_blank">View Photo</a>
              <br><img src="${data.url}" alt="Uploaded Photo" />
            `;
          } else {
            resultDiv.textContent = "Upload failed.";
          }
        } catch (err) {
          console.error(err);
          resultDiv.textContent = "Error uploading photo.";
        }
      });
    }

    // Create all cards
    squares.forEach((square, index) => createCard(square, index));

    // Load previous photos when player name is entered
    playerNameInput.addEventListener("change", async () => {
      const player = playerNameInput.value.trim();
      if (!player) return;

      try {
        const res = await fetch(`${workerURL}player?name=${encodeURIComponent(player)}`);
        const data = await res.json();

        squares.forEach((square, index) => {
          const resultDiv = document.getElementById(`result${index}`);
          const url = data[square];
          if (typeof url === "string") {
            resultDiv.innerHTML = `
              <a href="${url}" target="_blank">View Photo</a>
              <br><img src="${url}" alt="Uploaded Photo" />
            `;
          }
        });
      } catch (err) {
        console.error("Error loading previous photos:", err);
      }
    });
  </script>
</body>
</html>
