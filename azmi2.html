<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Starlink Pass Predictor (Offline)</title>
<script src="https://unpkg.com/satellite.js/dist/satellite.min.js"></script>
</head>
<body>
<h2>Starlink Pass Predictor (Pretoria)</h2>

<ul id="passes"></ul>

<script>
(async function() {
  const lat = -25.7479;
  const lon = 28.2293;
  const height = 1.32; // observer altitude in km

  // Example TLE for Starlink-1130 (replace with latest from https://celestrak.com/NORAD/elements/starlink.txt)
  const tleLine1 = "1 45127U 20029E   25271.58854167  .00001489  00000-0  84908-4 0  9996";
  const tleLine2 = "2 45127  53.0000 305.0000 0002922 180.0000 180.0000 15.05546810  1111";

  const satrec = satellite.twoline2satrec(tleLine1, tleLine2);

  const now = new Date();
  const passesList = document.getElementById("passes");
  passesList.innerHTML = "";

  // Check next 48 hours in 1-minute steps
  const end = new Date(now.getTime() + 48*60*60*1000);
  let visible = false;
  let passStart = null;

  for(let t = new Date(now); t < end; t.setMinutes(t.getMinutes()+1)) {
    const gmst = satellite.gstime(t);
    const positionEcf = satellite.propagate(satrec, t);
    if (!positionEcf.position) continue;
    const positionGd = satellite.eciToGeodetic(positionEcf.position, gmst);
    const lookAngles = satellite.ecfToLookAngles(
      {latitude: lat, longitude: lon, height: height},
      satellite.eciToEcf(positionEcf.position, gmst)
    );

    const elevation = lookAngles.elevation * 180 / Math.PI;

    if(elevation > 10 && !visible) { // pass starts
      visible = true;
      passStart = new Date(t);
    } else if (elevation <= 10 && visible) { // pass ends
      visible = false;
      const passEnd = new Date(t);
      const li = document.createElement("li");
      li.textContent = `Start: ${passStart.toLocaleString()} â†’ End: ${passEnd.toLocaleString()}`;
      passesList.appendChild(li);
    }
  }
})();
</script>
</body>
</html>